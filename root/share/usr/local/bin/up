#!/usr/bin/env bash
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com
#                DISTRO-BASED SYSTEM UPDATE
#────────────────────────────────────────────────────────────

source _bm
source _distro

#───────────────────────────────────────────────────────────────  ARCH  ───────

if [[ $DISTRO == arch* ]]; then

  log="$BMLOGS/pacfix_in.log"
  _a pacman/aur 
  yay -Syyyuuu --noconfirm 2>&1 | tee "$log"
  pacfix "$log"

#─────────────────────────────────────────────────────────────  CENTOS  ───────
elif [[ $DISTRO =~ centos ]]; then

  _w "configure me!"
  exit

#─────────────────────────────────────────────  DEBIAN RASPBIAN UBUNTU  ───────

elif [[ $DISTRO =~ raspbian*|debian*|ubuntu* ]]; then

  _t apt
  _a update && \
    sudo apt update -y && _s
  _a dist-upgrade && \
    sudo apt dist-upgrade -y && _s
  _a upgrade && \
    sudo apt upgrade -y && _s
  _a clean && \
    sudo apt clean -y && _s
  _a autoremove \
    && sudo apt autoremove --purge -y && _s
  _a autoclean \
    && sudo apt autoclean -y && _s
  _a purge old configs \
    && sudo apt purge -y $(dpkg -l | awk '/^rc/ { print $2 }') && _s

  # PIHOLE
  if pihole -v PIHOLE &> /dev/null; then
    _a pihole -up
    sudo pihole -up
  fi

  # DOCKER
  if docker-compose -v DOCKER-COMPOSE &> /dev/null; then
    dcr
  fi

  if [ -f /var/run/reboot-required ]; then
    _e "reboot is required!"
  fi

else # NOT CONFIGURED
  _e unconfigured distro\! update me\!\! && _i \"/usr/local/bin/up\"
fi

echo
exit 0
