#!/usr/bin/env bash
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com
#                 DOCKER-COMPOSE & REPO UPDATE [./dcr]
#────────────────────────────────────────────────────────────
#set -e

source _head
_t docker-compose 

cd ~/docker || (_e "~/docker missing!" && exit 1)

_a docker: update
if docker-compose up -d --remove-orphans; then
  _s
else
  _e something went wrong
fi

_a docker: add \& commit to repo

/usr/bin/git \
  --git-dir="$HOME"/docker/.git/ \
  --work-tree="$HOME"/docker \
  commit -a -m "automated update" \
  && _s \
  && _a docker: git push repo \
  && /usr/bin/git \
    --git-dir=/home/bmilcs/docker/.git/ \
    --work-tree=/home/bmilcs/docker push \
  && _s
