#!/usr/bin/env bash
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com
#────────────────────────────────────────────────────────────
#   MASS REPO GIT STATUS
#────────────────────────────────────────────────────────────
source _head

_t git status

exceptions=("nerd-fonts-2.0.0" "x")

rm -rf /tmp/{upno,upyes}

savelastline(){
  $1 | \
    tee >(sleep 1; [[ $(tail -n1) =~ 'Already up to date' ]] && echo "$(pwd)" >> /tmp/upno || echo "$(pwd)" >> /tmp/upyes )
  }

updaterepo() {
  # loop through dir
  for dir in */; do

    _a updating $dir

    match=0

    # if looped dir from above = an exception, match!
    for a in "${exceptions[@]}"; do
      [[ $dir == */$a/ ]] && match=1
    done

    # if match is found, skip this iteration
    [[ "$match" == 1 ]] && continue

    # cd into repo     # git pull using function 
    (cd "$(pwd)"/"$dir" && git status -s)

  done
  }

[ -d ~/gits ] && cd ~/gits && updaterepo || [ -d ~/repos ] && cd ~/repos && updaterepo 

