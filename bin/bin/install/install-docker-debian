#!/bin/sh
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com

# DOCKER INSTALL SCRIPT FOR DEBIAN [./install-docker-debian]
# https://docs.docker.com/engine/install/debian/#install-using-the-repository

source _bm
_t bmilcs docker installer

# remove old copies of docker
_a remove old copies of docker
sudo apt-get remove docker docker-engine docker.io containerd runc && _s "done"

# update apt
_a update apt
sudo apt-get update && _s "done"

# install dependencies
_a install dependencies
sudo apt-get install \ 
   apt-transport-https \
   ca-certificates \
   curl \
   gnupg \
   lsb-release \
   && _s "done"

# install docker gpg key
_a install docker gpg key
curl -fsSL https://download.docker.com/linux/debian/gpg \
  | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg \
  && _s "done"

# add stable repo
_a add stable repo
echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] \
  https://download.docker.com/linux/debian $(lsb_release -cs) stable" \
  | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null \
  && _s "done"

# update apt w/ newly added docker repo 
_a update apt w/ newly added docker repo 
sudo apt-get update \
  && _s "done"

# install docker
_a install docker
sudo apt-get install docker-ce docker-ce-cli containerd.io \
  && _s "done"

# ensure dockers installed correctly
_a ensure dockers installed correctly
sudo docker run hello-world \
  && _s "done"


