#!/usr/bin/env bash
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com

#                 SCREENSHOT SCRIPT [./screenshot]

source _bm

usage() { 
  ( _oc $(basename $0) 
  _oy   -t   type
  _o    -u   upload
  ) 1>&2
  exit 1; 
}

while getopts "t:u" opt; do
    case "${opt}" in
        t) type=${OPTARG} ;;
        u) upload=1 ;;
        *) usage ;;
    esac
done

[[ -z "${type}" ]] && usage

#is_mounted=$(mount -l | grep nfs)

#if [[ -n $is_mounted ]]; then
if [[ -e /a/bm/images/screenshots ]]; then
  f="/a/bm/images/screenshots/$(date +%Y-%m-%d_%H-%m-%s).png"
else
  _nw "'/a/bm' isn't mounted"
  f="$HOME/img/screenshots/$(date +%Y-%m-%d_%H-%m-%s).png"
fi

maimfail() {
  _ne maim fail.
  exit 1
}

case $type in
  all|mon|full)         maim "$f" || maimfail;;
  sel|select|selection) maim -s "$f" || maimfail;;
  win|window|active)    maim -i "$(xdotool getactivewindow)" "$f" || maimfail;;
esac

if [ -e "$f" ]; then
  if [ -n "$upload" ]; then
    upl "$f"
  else
    xclip -sel clip -t image/png -i "$f"
  fi
  _nimg "$f" "screenie" "screenshot taken"
fi

