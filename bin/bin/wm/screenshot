#!/usr/bin/env bash
#  ▄▄▄▄· • ▌ ▄ ·. ▪  ▄▄▌   ▄▄· .▄▄ ·   ──────────────────────
#  ▐█ ▀█▪·██ ▐███▪██ ██•  ▐█ ▌▪▐█ ▀.   ╔╦╗╔═╗╔╦╗╔═╗╦╦  ╔═╗╔═╗
#  ▐█▀▀█▄▐█ ▌▐▌▐█·▐█·██ ▪ ██ ▄▄▄▀▀▀█▄   ║║║ ║ ║ ╠╣ ║║  ║╣ ╚═╗
#  ██▄▪▐███ ██▌▐█▌▐█▌▐█▌ ▄▐███▌▐█▄▪▐█  ═╩╝╚═╝ ╩ ╚  ╩╩═╝╚═╝╚═╝
#  ·▀▀▀▀ ▀▀  █▪▀▀▀▀▀▀.▀▀▀ ·▀▀▀  ▀▀▀▀   https://dot.bmilcs.com
#                 SCREENSHOT SCRIPT [./screenshot]
#────────────────────────────────────────────────────────────

source _bm

set -x 
unset up

[[ $# -gt 1 ]] && up=1

if mount | grep /all/bm > /dev/null; then
  f="/all/bm/images/screenshots/$(date +%Y-%m-%d_%H-%m-%s).png"
else
  f="$HOME/img/$(date +%Y-%m-%d_%H-%m-%s).png"
fi

maimsel() {
  maim -s "$f"
  if [[ -n $up ]]; then 
    upl "$f"
  else
    xclip -sel clip -t image/png "$f"
  fi
  _ns "$f" "selection"
}

maimwin() {
  maim -i "$(xdotool getactivewindow)" "$f"
  if [[ -n $up ]]; then
    upl "$f"
  else 
    xclip -sel clip -t image/png "$f"
  fi
  _ns "$f" "window"
}

maimall() {
  maim "$f"
  if [[ -n $up ]]; then 
    upl "$f"
  else 
    xclip -sel clip -t image/png "$f"
  fi
  _ns "$f" "desktop"
}

[ "$1" == all ] && maimall
[ "$1" == win ] && maimwin
[ "$1" == sel ] && maimsel

set +x

_s
exit 0
